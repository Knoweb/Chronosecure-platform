name: Reset Database (Danger Zone)

on: workflow_dispatch

jobs:
  reset-db:
    runs-on: ubuntu-latest
    steps:
    - name: Reset Database Volume
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.DO_HOST }}
        username: ${{ secrets.DO_USERNAME }}
        key: ${{ secrets.DO_SSH_KEY }}
        script: |
          cd /root/chronosecure-app
          echo "Resetting Database..."
          
          # Wipe the database volume to fix password mismatch
          docker compose down -v
          
          # Restart Containers
          docker compose up -d
          
          echo "Database Reset Complete. Containers restarting."
