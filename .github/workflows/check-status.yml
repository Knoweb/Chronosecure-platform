name: Check Server Status

on:
  workflow_dispatch: # Allows manual trigger

jobs:
  check-status:
    runs-on: ubuntu-latest
    steps:
    - name: Check Containers & Logs
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.DO_HOST }}
        username: ${{ secrets.DO_USERNAME }}
        key: ${{ secrets.DO_SSH_KEY }}
        script: |
          echo "=== USER INFO ==="
          whoami
          pwd
          
          echo "=== CHECKING DIRECTORIES ==="
          ls -ld /home/root/chronosecure-app || echo "/home/root/chronosecure-app does not exist"
          ls -ld /root/chronosecure-app || echo "/root/chronosecure-app does not exist"
          
          echo "=== LISTING FILES IN TARGET ==="
          # Check where we think files are
          TARGET_DIR="/home/${{ secrets.DO_USERNAME }}/chronosecure-app"
          if [ -d "$TARGET_DIR" ]; then
            cd "$TARGET_DIR"
            ls -la
            
            echo "=== DOCKER COMPOSE CONFIG ==="
            docker compose config || echo "Docker Compose Config Failed"
            
            echo "=== TRYING TO START MANUAL ==="
            # Dry run of up to see errors
            docker compose up -d --dry-run || echo "Dry run failed"
          else
             echo "Directory $TARGET_DIR not found!"
          fi
          
          echo "=== DOCKER INFO ==="
          docker version
          docker compose version
